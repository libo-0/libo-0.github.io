---
title: Microservice-Architecture-微服务架构
tags:
  - Micro-service
  - 微服务
categories:
  - 微服务
  - Micro-service
img: >-
  https://docs.microsoft.com/en-us/azure/architecture/includes/images/microservices-logical.png
date: 2020-03-07 15:03:17
---


微服务是流行的架构风格来构建弹性、高度可扩展、可独立部署的、能够快速衍化的应用。但是成功的微服务架构需要不同的方法来设计和构建应用。

<!-- more -->

一个微服务架构包含了小的自主化的服务集合。每个服务是自我包含的，应该实现单个业务能力。

[图片来源 docs.microsoft.com, Building a microservices on Azure][0]

## 什么是微服务？

* 微服务是小的、独立的、稀松耦合的。单个小团队能够写和维护一个服务。
* 每个服务是一个单独的代码仓库，可以被一个小的开发团队管理。
* 服务能够单独部署。一个团队能够更新一个已存在的服务而不用重新构建或者重新部署整个应用
* 服务有责任持久化他们自己的数据或外部状态。这不同于传统的模型，单个数据层来处理数据持久化。
* 服务间沟通通过定义好的 API。每个服务的内部实现是隐藏的。
* 服务不需要共享相同的技术栈，库，框架。

除了服务自己，一些其他组件出现在典型的微服务架构；

**管理/乐队**. 这个组件有责任放置服务到节点，标识失败，调整节点间的负载均衡，等等。典型的这个组件使用线程的技术例如 Kubernetes，而不是自己构建的。

**API Gateway**. 这个 API 网关是客户端的入口。Instead of 之间调用服务，客户端直接调用 API 网关，由 API 网关转发调用到合适的后端服务。

API 网关的有点包括：

* 将客户端与服务解耦。服务可以版本化和重构，而不需要客户端的更新。

* 服务可以使用非 web 友好的协议，列入 AMQP。

* API Gateway 能够执行其他跨-切的功能例如认证，日志，SSL termination，和负载均衡。

## 益处

* 迅捷. 因为微服务独立部署，bug 修复和 feature 发布更简单。你能够更新一个服务而不用重新部署整个应用，回滚一个更新如果出错的话。在一个传统的应用中，如果一个 bug 在应用的一部分被发现，它会阻塞整个发布进程。新的特点可能会被阻塞，由于bug 修复的集成，测试，发布。

* 小，专注团队. 一个微服务应该足够小，单个特征团队能够构建，测试，部署，小的团队促进迅捷。辣的团队取消于更没有生产力，因为沟通更慢，管理成本上升，迅捷性减少。

* 小的代码仓库。在一个巨石应用，趋势是代码依赖三角化，新的特点需要触动更多地方的代码。不共享代码或者数据中心，一个微服务架构最小化了依赖，使它添加新特点更简单。

* 混合技术。团队可以选择最适合他们的技术，使用合适的技术栈。

* 错误孤立。如果一个微服务不能获得，它不会终端整个应用，只要上传流的微服务被设置成正确处理错误（例如实现熔断）。

* 规模。服务可能单独规模化，让你规模子系统，需要更多的资源，而不用规模化整个应用。使用一个指挥家例如 Kubernete 或者 Service Fabric，你能够打包和一个高密度的服务到单个主机，允许更有效的利用资源。

* 数据孤立。执行模式更新更简单，因为只有单个微服务受到影响，在一个巨石应用中，模式更新变得很有挑战性，因为应用的不同部分触碰相同的数据，让这些改变更有风险。

## 挑战

* 复杂性。一个微服务应用比巨石应用有更多的可变部分。每个服务更简单，但是整个系统作为整体更复杂了。

* 开发和测试。写一个小的服务，依赖于其他服务，比起传统的巨石应用需要不同的方法。已存在的工具并不总是被设计为于服务依赖工作的。重构跨服务的边界变得困难。测试服务依赖同样具有挑战性，尤其是应用快速衍化的时候。

* 确实掌控。去中心化的方法构建微服务应用有优点，但同样造成问题。最终，你可能会有很多不同的语言和框架，应用变得难以维护。将项目范围的标准统一可能有用，而不会约束团队的灵活性。这尤其适用于跨切的功能。

* 网络拥堵和延迟。使用小颗粒的服务可能导致更多的服务间沟通。同样，服务依赖链变得太长，附加的延迟可能成为一个问题。你需要小心的设计 API。避免 overly chatty 的API，考虑序列化的方式，查找异步沟通模式。

* 数据整体性。当每个微服务有责任维护自己的数据持久化时，结果，数据一致性成为挑战，典型的，日志必须关联单个用户操作的多个服务调用。

* 版本化。 单个服务的更新不会破坏依赖它的服务。多个服务能够在任意事件更新，所以不特别设计，你可能会遇到向后或向前兼容性。

* 技能集。微服务是高度分布式的系统。小心评估团队是否有技巧和经验来变得成功。



## 参考

[Building microservices on Azure][1], docs.microsoft.com

[0]: https://docs.microsoft.com/en-us/azure/architecture/includes/images/microservices-logical.png
[1]: https://docs.microsoft.com/en-us/azure/architecture/microservices/